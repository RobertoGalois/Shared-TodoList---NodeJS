<!DOCTYPE html>

<html lang="fr">
<head>
    <title>Ma todolist</title>
    <style>
        a {text-decoration: none; color: black;}
    </style>
</head>

<body>
<h1>Ma todolist</h1>

<div id="mytodolist">
    <ul>
        <% todolist.forEach(function(todo, index) { %>
            <li><a href="/todo/supprimer/<%= index %>">✘</a> <%= todo %></li>
        <% }); %>
    </ul>
</div>


<form action="/todo/ajouter/" method="post">
    <p>
        <label for="newtodo">Que dois-je faire ?</label>
        <input type="text" name="newtodo" id="newtodo" autofocus />
        <input type="submit" />
    </p>
</form>



<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>

    let socket = io.connect('http://localhost:8080');

    // Si on recoit un message 'todolist' on appelle la fonction d'affichage
    socket.on('todolist', function(todolist) {
        if(typeof todolist !== 'undefined'){
            afficheTodolist(todolist);
        }
    });


    /* Créer une liste (ul) et ajoute chaque élément (li + a)
       puis ajoute la liste dans la div prévue à cet effet (#mytodolist) */
    function afficheTodolist(todolist){

        let ul = document.createElement("ul");

        todolist.forEach(function (todo, index) {

            let li = document.createElement("li");
            let lien = document.createElement("a");
            let tache = document.createTextNode(" " + todo);
            let croix = document.createTextNode("✘");

            lien.href = "/todo/supprimer/" + index;
            lien.appendChild(croix);

            li.appendChild(lien);
            li.appendChild(tache);

            ul.appendChild(li)
        })

        $("#mytodolist").html(ul);
    }

</script>
</body>
</html>